<!DOCTYPE html>

<html>
    <head>
        <meta charset="UTF-8">
        <title>WebGPU Game of Life</title>
    </head>
    
    <body>
        <canvas width="512" height="512"></canvas>
    
        <script type="module">
            // Using module let's you use await without needing to wrap everything in an async function
            // Useful for WebGPU initialization

            const canvas = document.querySelector("canvas");

            // Check if WebGPU is supported in the browser -->
            if (!navigator.gpu) {
                throw new Error("WebGPU not supported on this browser.");
            }
          
            // Request access to GPU
            const adapter = await navigator.gpu.requestAdapter();
            if (!adapter) {
                throw new Error("No appropriate GPUAdapter found.");
            }

            const device = await adapter.requestDevice();

            // Configure Canvas
            const context = canvas.getContext("webgpu"); // target where WebGPU will render to
            const canvasFormat = navigator.gpu.getPreferredCanvasFormat(); // get ideal pixel format for the canvs
            context.configure({ // configure webgpu context
                device: device,
                format: canvasFormat
            });

            // Clear the canvas with solid color
            const encoder = device.createCommandEncoder(); // records sequence of GPU commands to be executed later
            const pass = encoder.beginRenderPass({ // collection of draw commands that target canvas
                colorAttachments: [
                    {
                        view: context.getCurrentTexture().createView(), // what to render to
                        loadOp: 'clear', // clear the texture when the pass starts
                        storeOp: 'store', // store the result after rendering
                        clearValue: { r: 0.0, g: 0.0, b: 0.4, a: 1.0 }, // dark blue color
                    }
                ]
            });
            
            // finalize the command buffer and submits it to the GPU for execution
            pass.end()
            device.queue.submit([encoder.finish()]);


        </script>
    </body>
</html>
